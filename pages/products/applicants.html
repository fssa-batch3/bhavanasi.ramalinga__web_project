<!DOCTYPE html>
<html lang="en">

    <head>
        <link rel="stylesheet" href="../../assets/css/applicants.css">
        <link rel="stylesheet" href="../../assets/css/header.css">
        <link rel="stylesheet" href="../../assets/css/footer.css">
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>
        <title>Applicant</title>

    </head>

    <body>
        <header>

        </header>

        <div class="section"></div>
        
                               

            <script>const owner = JSON.parse(localStorage.getItem("pgdetails"));
             console.log(owner);
            const searching = window.location.search;
            console.log(searching);
            const newurl = new URLSearchParams(searching);
            const pg_id = newurl.get("my_uuid");
            console.log(pg_id);
            const selected_room = newurl.get("my_room_id");
            console.log(selected_room);
            
             const Applicant = owner.find((e) => e.my_uuid == pg_id);
             console.log(Applicant);

            const selectedObject = owner.find((object) => object.share_data.find((data) => data.name === selected_room));

           
                // Get the image from the selected object
                const selectedImage = Applicant.share_data.find((data) => data.name === selected_room).image;
               
                console.log(selectedImage);

                const selectedrent = selectedObject.share_data.find((data) => data.name === selected_room).rent;
                console.log(selectedrent);

                const div_border = document.createElement("div");
            div_border.setAttribute("class", "border");
            document.querySelector(".section").append(div_border);


                const div_image = document.createElement("div");
              div_image.setAttribute("class", "detail");
              div_border.append(div_image);

              const img = document.createElement("img");
              img.setAttribute("src", selectedImage);
              img.setAttribute("id", "image");
              img.setAttribute("alt", "photo");
              img.setAttribute("height", "300px");
              img.setAttribute("width", "300px");
              div_image.append(img);
              const h2 = document.createElement("h2");
            h2.setAttribute("class", "pg_name");
            div_image.append(h2);

            const Name_ofthepg = document.createElement("h3");
            Name_ofthepg.setAttribute("class", "name_of_pg");
            Name_ofthepg.setAttribute("id", "name");
            Name_ofthepg.innerText = Applicant.pg_details.name;
            h2.append(Name_ofthepg);

            const div_two = document.createElement("div");
            div_two.setAttribute("class", "moredetail");
            h2.append(div_two);

            const sharing_room = document.createElement("h3");
            sharing_room.setAttribute("id", "share");
            sharing_room.innerText = selected_room;
            div_two.append(sharing_room);

            const monthly_rent = document.createElement("p");
            monthly_rent.setAttribute("id", "rent");
            monthly_rent.innerText = "Monthly Rent:";
            div_two.append(monthly_rent);

            const b_one = document.createElement("span");
            b_one.setAttribute("id", "sharing");
            b_one.innerText = selectedrent;
            monthly_rent.append(b_one);

            const advance_three = document.createElement("b");
            advance_three.setAttribute("id", "advance");
            advance_three.innerText = "Advance:";
            div_two.append(advance_three);

            const b_four = document.createElement("span");
            b_four.setAttribute("id", "amount");
            b_four.innerText = Applicant.pg_details.advance;
            advance_three.append(b_four);

            const book_button = document.createElement("button");
            book_button.setAttribute("class", "button");
            book_button.setAttribute("type", "submit");

            book_button.innerText = "Book Now";
            book_button.onclick = function (event) {
              signUp(event);
            };
            b_four.append(book_button);
            


           

          

            function signUp(e) {
              e.preventDefault();
              const my_uuid = uuidv4();
              const currentDate = new Date();
              const year = currentDate.getFullYear();
              const month = currentDate.getMonth() + 1;
              const date = currentDate.getDate();

              console.log(year);
              console.log(month);
              console.log(date);

const customer_id = JSON.parse(localStorage.getItem("userId"));
const product_id = JSON.parse(localStorage.getItem("productId"));
const room_book_request = JSON.parse(localStorage.getItem("room_book_request")) || [];


 
const exit = room_book_request.some((data) => data.product_id === pg_id && data.customer_id === customer_id && data.selected_room === selected_room);

if (!exit) {
  room_book_request.push({
    request_id: my_uuid,
    customer_id,
    product_id: pg_id,
    status: 1,
    selected_room,
    image: selectedImage,
    rent: selectedrent,
    pgname: Applicant.pg_details.name,
    dateAndTime: `${date}/${month}/${year}`,
  });

  localStorage.setItem("room_book_request", JSON.stringify(room_book_request));
  console.log(localStorage.getItem("room_book_request"));
  alert("Request sent successfully");
} else {
  alert("Already booked");
}
}


            // responses come here//

            function Logout(e) {
              alert("are you sure to logout");

              localStorage.removeItem("userId");
              window.location.href = "/index.html";
            }

            //date and year//
        </script>
        <script src="/assets/js/header.js"></script>
        <script src= "/assets/js/footer.js"></script>
</body>

</html>